C51 COMPILER V9.60.7.0   DHT11                                                             06/27/2025 11:26:42 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN ..\Output\dht11.obj
COMPILER INVOKED BY: D:\APP\Keil_v5\C51\BIN\C51.EXE ..\BSP\Src\dht11.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP\Inc;
                    -..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\dht11.lst) OBJECT(..\Output\dht1
                    -1.obj)

line level    source

   1          #include  "dht11.h" 
   2          
   3          /**
   4           * @brief       DHT11è¯»å–å¼€å§‹ æ—¶åºå˜åŒ–
   5           *
   6           * @param   
   7           *
   8           * @return  è¯»å–çš„å­—èŠ‚
   9          **/
  10          void DHT11_start()
  11          {
  12   1          Temp_Hum = 1;
  13   1          delay_us(2);
  14   1      
  15   1          Temp_Hum = 0;
  16   1          delay_ms(25);   //æ‹‰ä½å»¶æ—¶18msä»¥ä¸Š
  17   1      
  18   1          Temp_Hum = 1;
  19   1          delay_us(30);   //æ‹‰é«˜ å»¶æ—¶ 20~40usï¼Œå–ä¸­é—´å€¼ 30us
  20   1      }
  21          
  22          /**
  23           * @brief       ä»DHT11è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ŒMSBå…ˆè¡Œ
  24           *
  25           * @param   
  26           *
  27           * @return  è¯»å–çš„å­—èŠ‚
  28          **/
  29          static uint8_t Read_Byte(void)  
  30          {       
  31   1              uint8_t i, dat = 0;
  32   1      
  33   1              for( i = 0; i < 8; i++ )    
  34   1              {          
  35   2                      while(!Temp_Hum); //æ¯bitä»¥50usä½ç”µå¹³æ ‡ç½®å¼€å§‹ï¼Œè½®è¯¢ç›´åˆ°ä»æœºå‘å‡º çš„50us ä½ç”µå¹³ ç»“æ
             -Ÿ
  36   2      
  37   2                      delay_us(40); //å»¶æ—¶çº¦40us,è¿™ä¸ªå»¶æ—¶éœ€è¦å¤§äºæ•°æ®0æŒç»­çš„æ—¶é—´å³å¯                
  38   2      
  39   2              if(Temp_Hum)   //çº¦40usåä»ä¸ºé«˜ç”µå¹³è¡¨ç¤ºæ•°æ®â€œ1â€
  40   2                      {
  41   3                              while(Temp_Hum);  //ç­‰å¾…æ•°æ®1çš„é«˜ç”µå¹³ç»“æŸ
  42   3                              dat|=(uint8_t)(0x01<<(7-i));  //æŠŠç¬¬7-iä½ç½®1ï¼ŒMSBå…ˆè¡Œ 
  43   3                      }
  44   2                      else     //40usåä¸ºä½ç”µå¹³è¡¨ç¤ºæ•°æ®â€œ0â€
  45   2                      {                          
  46   3                              dat&=(uint8_t)~(0x01<<(7-i)); //æŠŠç¬¬7-iä½ç½®0ï¼ŒMSBå…ˆè¡Œ
  47   3                      }
  48   2              }
  49   1              return dat;     
  50   1      }
  51          
  52          /**
C51 COMPILER V9.60.7.0   DHT11                                                             06/27/2025 11:26:42 PAGE 2   

  53           * @brief       è¯»å–æ¸©æ¹¿åº¦
  54           *
  55           * @param   
  56           *
  57           * @return  è¯»å–çš„å­—èŠ‚
  58          **/
  59          void Read_DHT11(void)       
  60          {
  61   1          uint8_t R_H,R_L,T_H,T_L,revise; 
  62   1      
  63   1          DHT11_start();
  64   1              
  65   1          /* 1, åˆ¤æ–­ä»æœºæ˜¯å¦æœ‰ä½ç”µå¹³å“åº”ä¿¡å· å¦‚ä¸å“åº”åˆ™è·³å‡ºï¼Œå“åº”åˆ™å‘ä¸‹è¿è¡Œ   */
  66   1          if(!Temp_Hum)      
  67   1          {
  68   2              /* 2, è½®è¯¢ç›´åˆ°ä»æœºå‘å‡ºçš„83us ä½ç”µå¹³ å“åº”ä¿¡å·ç»“æŸ   */
  69   2              while(!Temp_Hum);  
  70   2      
  71   2              /* 3, è½®è¯¢ç›´åˆ°ä»æœºå‘å‡ºçš„87us é«˜ç”µå¹³ æ ‡ç½®ä¿¡å·ç»“æŸ   */
  72   2              while(Temp_Hum);    
  73   2                              
  74   2                      /* 4, å¼€å§‹æ¥æ”¶æ•°æ®                                */       
  75   2              R_H= Read_Byte();
  76   2              R_L= Read_Byte();
  77   2              T_H= Read_Byte();
  78   2              T_L= Read_Byte();
  79   2      
  80   2              revise = Read_Byte();
  81   2      
  82   2              /* 5, è¯»å–ç»“æŸï¼Œä¸»æœºæ‹‰é«˜                          */    
  83   2              Temp_Hum =1 ;                   
  84   2      
  85   2              /* 6, æœ€åä¸€å­—èŠ‚ä¸ºæ ¡éªŒä½ï¼Œæ ¡éªŒæ˜¯å¦æ­£ç¡®            */
  86   2              if( (R_H+R_L+T_H+T_L) == revise )      //
  87   2              {
  88   3                  /* 7, æ ¡éªŒæ­£ç¡®ï¼Œä¸ºç»“æ„ä½“èµ‹å€¼                  */
  89   3                  temp.dht11_temp  = T_H;
  90   3                  temp.dht11_humidity = R_H;
  91   3              }
  92   2          } 
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    229    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
